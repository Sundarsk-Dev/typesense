<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Typesense - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-6"
  >
    <!-- Header -->
    <h1 class="text-3xl font-bold text-yellow-400 mb-6">ðŸ“Š Typing Dashboard</h1>

    <!-- Latest Mood Report -->
    {% if rows %}
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-2xl mb-6">
      <h2 class="text-xl font-semibold">Latest Mood Report</h2>
      <p class="text-yellow-400 text-2xl mt-2">{{ rows[0][5] }}</p>
      <p class="text-gray-400 text-sm">
        Based on your most recent typing session
      </p>
    </div>
    {% else %}
    <p class="text-gray-400">No typing sessions yet. Try the test first.</p>
    {% endif %}

    <!-- Chart -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-4xl mb-6">
      <h2 class="text-xl font-semibold mb-4">Typing Speed Over Sessions</h2>
      <canvas id="typingChart"></canvas>
    </div>

    <!-- Buttons -->
    <div class="flex space-x-4">
      <a
        href="/"
        class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 rounded-lg text-black font-semibold"
      >
        â¬… Back to Typing
      </a>
      <a
        href="/clear"
        class="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg text-white font-semibold"
      >
        ðŸ”„ Reset Data
      </a>
    </div>

    <script>
      const labels = {{ rows|map(attribute=1)|list|tojson }};
      const speeds = {{ rows|map(attribute=2)|list|tojson }};

      const ctx = document.getElementById("typingChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          labels: labels.reverse(),
          datasets: [{
            label: "Typing Speed (WPM)",
            data: speeds.reverse(),
            borderColor: "#facc15",
            backgroundColor: "#facc15",
            tension: 0.3,
            fill: false,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { labels: { color: "white" } }
          },
          scales: {
            x: { ticks: { color: "white" } },
            y: { ticks: { color: "white" } }
          }
        }
      });
    </script>
  </body>
</html>
